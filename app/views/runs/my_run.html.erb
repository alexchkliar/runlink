<h1><%= @run.trail.name %></h1>
<div class="new-run-top">
  <% @run.trail.photos.each do |photo| %>
    <li><%= cl_image_tag photo.key, height: 180, width: 330, crop: :fill %></li>
  <% end %>
  <div id="map"></div>
    <script>
    	mapboxgl.accessToken = 'pk.eyJ1IjoiZGF2aWRzaGluMDQxMyIsImEiOiJja3ZjdTF5MGI5cTJsMnZ0OWswemNhZ280In0.nLv4luqxmntZuFehb11fvQ';
      const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/streets-v11',
        center: [-122.486052, 37.830348],
        zoom: 15
      });

      map.on('load', () => {
        map.addSource('route', {
          'type': 'geojson',
          'data': {
            'type': 'Feature',
            'properties': {},
            'geometry': {
              'type': 'LineString',
              'coordinates': [
                [-122.483696, 37.833818],
                [-122.483482, 37.833174],
                [-122.483396, 37.8327],
                [-122.483568, 37.832056],
                [-122.48404, 37.831141],
                [-122.48404, 37.830497],
                [-122.483482, 37.82992],
                [-122.483568, 37.829548],
                [-122.48507, 37.829446],
                [-122.4861, 37.828802],
                [-122.486958, 37.82931],
                [-122.487001, 37.830802],
                [-122.487516, 37.831683],
                [-122.488031, 37.832158],
                [-122.488889, 37.832971],
                [-122.489876, 37.832632],
                [-122.490434, 37.832937],
                [-122.49125, 37.832429],
                [-122.491636, 37.832564],
                [-122.492237, 37.833378],
                [-122.493782, 37.833683]
              ]
            }
          }
        });
        map.addLayer({
          'id': 'route',
          'type': 'line',
          'source': 'route',
          'layout': {
          'line-join': 'round',
          'line-cap': 'round'
          },
          'paint': {
          'line-color': 'red',
          'line-width': 6
          }
        });
      });
    </script>
  <h2 class="trail-booking-header"><%= @run.trail.location %>, <%= @run.trail.distance %>km</h2>
  <ul>
    <li>Date & time: <%= @run.date %></li>
    <li><%= link_to @run.trail.location, trail_path(@run.trail) %></li>
    <li>Organizer:
      <%= link_to @organizer.name, user_path(@organizer) %>
      <% if @organizer == current_user %>
        <%= "(you)" %>
      <% end %>
    </li>
      <%= "Difficulty: " %>
      <% @run.trail.difficulty.ceil.times do %>
        <%="★"%>
      <% end %>
      <% (5 - @run.trail.difficulty.ceil).times do %>
        <%="☆"%>
      <% end %>
    </li>
    <li>
      <%= "Rating: " %>
      <%# @run.trail.rating.ceil.times do %>
        <%#="★"%>
      <%# end %>
      <%# (5 - @run.trail.rating.ceil).times do %>
        <%#="☆"%>
      <%# end %>
    </li>
  </ul>

  <h2 class="participating-runners-header"> <%= @run.run_participants.length %> runners participating: </h2>
  <div class="run-participants-list">
    <% if @participant_users.include?(current_user) %>
      <div class="participant-profile">
        <%= cl_image_tag current_user.avatar.key %>
        <%= link_to current_user.name, user_path(current_user) %>
        <%= "(you)" %>
      </div>
    <% end %>
    <% @participant_users.each do |participant| %>
      <% unless participant == current_user %>
        <div class="participant-profile">
          <%= cl_image_tag participant.avatar.key %>
          <%= link_to participant.name, user_path(participant) %>
        </div>
      <% end %>
    <% end %>
  </div>
  <%= link_to "Record Run", register_run_path, class:"btn-create-run d-block w-100 text-center"%>
</div>
